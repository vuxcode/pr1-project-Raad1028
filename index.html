<meta name="color-scheme" content="dark">
<!-- A button to test the diceroll function -->
<button id="rollTestBtn">Test the D20 roll</button>
<!-- This is where the results of the dicerolls are displayed. -->
<div id="text-test"></div>
<button id="regularAtkBtn">Regular Attack</button>
<button id="heavyAtkBtn">Heavy Attack</button>
<script>
// Create the variables and arrays with placeholder values.
var D20Result = null
var playerAction = ["action", "roll", "damage", "dodgeAdvantage"]

var enemyAction = ["action", "roll", "damage", "dodgeAdvantage"]
var turnCounter = 0
var playerMaxHP = 50
var playerCurrentHP = 50
var enemyMaxHP = 50
var enemyCurrentHP = 50
var damagePreModify = 0
// Creates a variable for the rollTestBtn button.
var rollTestBtn = document.getElementById("rollTestBtn")
// Links the test button to the testRoll function.
rollTestBtn.addEventListener("click", testRoll);

//Creates a variable for the regularAtkBtn button.
var regularAtkBtn = document.getElementById("regularAtkBtn")
// Links the regularAtkBtn to the regularAtk function.
regularAtkBtn.addEventListener("click", regularAtk)

var heavyAtkBtn = document.getElementById("heavyAtkBtn")

heavyAtkBtn.addEventListener("click", heavyAtk)

// Create a function for the dice roll
function D20roll() {
    // First the fuction generates a number and then checks which group it fits in with
    D20Result = Math.random().toFixed(3);
    if (D20Result < 0.05) {
        D20Result = 1
    }
    else if (D20Result < 0.1) {
        D20Result = 2
    }
    else if (D20Result < 0.15) {
        D20Result = 3
    }
    else if (D20Result < 0.2) {
        D20Result = 4
    }
    else if (D20Result < 0.25) {
        D20Result = 5
    }
    else if (D20Result < 0.3) {
        D20Result = 6
    }
    else if (D20Result < 0.35) {
        D20Result = 7
    }
    else if (D20Result < 0.4) {
        D20Result = 8
    }
    else if (D20Result < 0.45) {
        D20Result = 9
    }
    else if (D20Result < 0.5) {
        D20Result = 10
    }
    else if (D20Result < 0.55) {
        D20Result = 11
    }
    else if (D20Result < 0.6) {
        D20Result = 12
    }
    else if (D20Result < 0.65) {
        D20Result = 13
    }
    else if (D20Result < 0.7) {
        D20Result = 14
    }
    else if (D20Result < 0.75) {
        D20Result = 15
    }
    else if (D20Result < 0.8) {
        D20Result = 16
    }
    else if (D20Result < 0.85) {
        D20Result = 17
    }
    else if (D20Result < 0.9) {
        D20Result = 18
    }
    else if (D20Result < 0.95) {
        D20Result = 19
    }
    else if (D20Result < 1) {
        D20Result = 20
    }
}

// Create a function meant only to be used for testing purposes.
function testRoll() {
    // Executes the D20roll function
    D20roll();
    // Displays the result on the page.
    document.getElementById("text-test").innerHTML += "You rolled a '" + D20Result + "' on your d20 <br>";
}
// Create a function for the regular attack.
function regularAtk() {
    turnCount();
    // Stores the player action in an array.
    playerAction[0] = "regatk"
    playerRoll();
    // Executes the enemy turn function.
    enemyTurn();
    // If the enemy's action is parry, this part will execute
    if (enemyAction[0] == "parry") {
        
        // If the player rolled higher than the enemy, this part will execute.
        if (playerAction[1] > enemyAction[1]) {
            console.log("Enemy failed to parry. Enemy rolled a " + enemyAction[1] + " against the player's " + playerAction[1] + ".");
            playerRegAtk();
            
        }
        // If the player rolled lower than the enemy, this part will execute.
        else {
            // Rolls the dice that will decide the damage dealt.
            D20roll();
            // Damage dealt is the dice result divided by 2
            enemyAction[2] = D20Result / 2
            // In the case the result has decimals, result is rounded up.
            enemyAction[2] = Math.ceil(enemyAction[2])
            console.log("Enemy parry was successful. Enemy rolled a " + enemyAction[1] + " while the player rolled a " + playerAction[1] + ". Enemy deals " + enemyAction[2] + " damage to the player.")
            console.log("Player attack missed because of the enemy's successful parry")
        }
    
    }
    // If the enemy's action is dodge, this part will execute.
    else if (enemyAction[0] == "dodge") {
        // If the player rolled higher than 10, this part will execute
        if (playerAction[1] > 10) {
            // Rolls and stores the damage.
            D20roll();
            playerAction[2] = Math.ceil(D20Result / 2)
            // If the enemy rolled any number between 18-20 on their dice, this part executes
            if (enemyAction[1] > 17) {
                // A dodge roll of 18 and above will be considered a full dodge and will make the user take no damage for that turn.
                playerAction[2] = 0
                console.log("Enemy dodge was successful. Enemy rolled a '" + enemyAction[1] + "' and thus managed to completely dodge the players attack. The enemy will get a +2 on their next roll")
                // Stores the +2 for next turn.
                enemyAction[3] = 2
            }
            // If the enemy rolled any number between 13-17 on their dice, this part executes
            else if (enemyAction[1] > 12) {
                // Stores what the damage would have been if the enemy didn't use dodge.
                damagePreModify = playerAction[2]
                // A dodge roll between 13-17  will cause the attacker to only deal 30% of what they would've dealt otherwise.
                playerAction[2] = Math.ceil(playerAction[2] * 0.3)
                console.log("Enemy dodge was successful. Enemy rolled a '" + enemyAction[1] + "' and will therefore only take '" + playerAction[2] + "' instead of '" + damagePreModify + "'. The enemy will get a +2 on their next roll")
                // Stores the +2 for next turn
                enemyAction[3] = 2
            }
            // If the enemy rolled any number between 8-12 on their dice, this part executes
            else if (enemyAction[1] > 7) {
                // Stores what the damage would have been if the enemy didn't use dodge.
                damagePreModify = playerAction[2]
                // A dodge roll between 8-12 will cause the attacker to only deal 50% of what they would've dealt otherwise.
                playerAction[2] = Math.ceil(playerAction[2] * 0.5)
                console.log("Enemy dodge was successful. Enemy rolled a '" + enemyAction[1] + "' and will therefore only take '" + playerAction[2] + "' instead of '" + damagePreModify + "'. The enemy will get a +2 on their next roll")
                // Stores the +2 for next turn
                enemyAction[3] = 2
            }
            // If the enemy rolled any number between 4-7 on their dice, this part executes
            else if (enemyAction[1] > 3) {
                // Stores what the damage would have been if the enemy didnt use dodge.
                damagePreModify = playerAction[2]
                // A dodge roll between 4-7 will cause the attacker to only deal 70% of what they would've dealt otherwise.
                playerAction[2] = Math.ceil(playerAction[2] * 0.7)
                console.log("Enemy dodge was successful. Enemy rolled a '" + enemyAction[1] + "' and will therefore only take '" + playerAction[2] + "' instead of '" + damagePreModify + "'. The enemy will get a +1 on their next roll")
                // Stores the +1 for next turn
                enemyAction[3] = 1
            }
            // If the enemy rolled any number between 1-3 on their dice, this part executes
            else {
                // A dodge roll between 1-3 will have no effect on the damage taken, but will still store a +1 for next turn
                console.log("Enemy dodge failed. Enemy rolled a '" + enemyAction[1] + "' and will take the full '" + playerAction[2] + "' damage from the player. Enemy will still get a +1 on their next roll.")
                // Stores the +1 for next turn
                enemyAction[3] = 1
            }
        
        }
        // If the player rolled 10 or below, this part executes.
        else {
            // A regatk roll 10 or below will deal 0 damage.
            playerAction[2] = 0
            console.log("Enemy dodge was successful due to the player rolling a '" + playerAction[1] +  "'. Enemy will get a +1 on their next roll.")
            // Stores the +1 for next turn
            enemyAction[3] = 1
        }
    }
    // If the enemy didn't pick "dodge" or "parry", this part executes.
    else {
       playerRegAtk();
        
    }
    // If the enemy action is regatk, execute the enemyRegAtk function.
    if (enemyAction[0] == "regatk") {
        enemyRegAtk()
    }
    // If the enemy action is heavyatk, execute the enemyHeavyAtk function.
    if (enemyAction[0] == "heavyatk") {
        enemyHeavyAtk()
    }
}
// Create a function for the heavy attack.
function heavyAtk() {
    // Tracks and writes the current turn number in console.
    turnCount();
    // Stores the player action in an array.
    playerAction[0] = "heavyatk"
    // Rolls and stores the player dice roll.
    playerRoll();
    //Executes the enemy turn function.
    enemyTurn();
    // If the enemy's action is parry, this part will execute
    if (enemyAction[0] == "parry") {
        
    }
}


// Create a function which decides the enemy's turn.
function enemyTurn() {
    // Rolls a dice which decides what action the enemy will do for their turn
    D20roll();
    if (D20Result <= 5) {
        enemyAction[0] = "regatk"
    }
    else if (D20Result <= 10) {
        enemyAction[0] = "heavyatk"
    }
    else if (D20Result <= 15) {
        enemyAction[0] = "parry"
    }
    else {
        enemyAction[0] = "dodge"
    }    
    // Rolls the dice for the enemy.
    D20roll();
    // Stores the dice result in an array.
    enemyAction[1] = D20Result
    console.log("Enemy action is '" + enemyAction[0] + "' with a dice roll of '" + enemyAction[1] + "'")
}

// Function that activates if the enemy action is regatk
function enemyRegAtk() {
    // If the enemy rolls above 10, this part executes.
    if (enemyAction[1] > 10) {
        D20roll()
        // The damage dealt is decided here
        enemyAction[2] = Math.ceil(D20Result / 2)
        console.log("Enemy regular attack hit with a dice roll of '" + enemyAction[1] + "'. Enemy deals '" + enemyAction[2] + "' to the player")
    }
    // If the enemy rolls below 11, this part executes
    else {
        // A regatk roll below 11 deals 0 damage.
        enemyAction[2] = 0
        console.log("Enemy missed their regular attack with a dice roll of '" + enemyAction[1] + "'")
    }
}
// Function that activates if the enemy action is heavyatk
function enemyHeavyAtk() {
    // If the enemy rolls above 12, this part executes
    if (enemyAction[1] > 12) {
        D20roll()
        // The damage dealt is decided here
        enemyAction[2] = Math.ceil(D20Result * 0.8)
        console.log("Enemy heavy attack hit with a dice roll of '" + enemyAction[1] + "'. Enemy deals '" + enemyAction[2] + "' to the player")
    }
    // If the enemy rolls below 13, this part executes
    else {
        // A heavyatk roll below 13 deals 0 damage
        enemyAction[2] = 0
        console.log("Enemy missed their heavy attack with a dice roll of '" + enemyAction[1] + "'")
    }
}
// A function that keeps track of what turn the battle is on.
function turnCount() {
    console.log(" ")
    turnCounter += 1
    console.log("Turn " + turnCounter + ":")
}
// A function that rolls the dice for the player.
function playerRoll() {
    // Rolls the dice for the player.
    D20roll();
    // Stores the dice result in an array.
    playerAction[1] = D20Result
    console.log("Player action is '" + playerAction[0] + "' with a dice roll of '" + playerAction[1] + "'")
}

function playerRegAtk() {
    if (playerAction[1] > 10 ) {
            // Rolls a dice which decides how much damage the player will deal.
                D20roll();
                // Stores the result of the dice in an array.
                playerAction[2] = D20Result / 2
                // If the result has decimals, the result is rounded up.
                playerAction[2] = Math.ceil(playerAction[2])
                console.log("Player rolled a '" + playerAction[1] + "' and hits the regular attack and deals '" + playerAction[2] + "' damage to the enemy.")
            }

            else {
                // If the player rolled 10 or below, damage dealt is set to 0
                playerAction[2] = 0
                console.log("Player rolled a '" + playerAction[1] + "' and misses the regular attack")
            }
}
</script>